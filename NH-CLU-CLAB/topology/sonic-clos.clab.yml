name: sonic-clos

topology:
  nodes:
    # Spine switches
    spine1:
      kind: sonic-vs
      image: docker-sonic-vs:latest
      type: ""

    spine2:
      kind: sonic-vs
      image: docker-sonic-vs:latest
      type: ""

    # Leaf switches
    leaf1:
      kind: sonic-vs
      image: docker-sonic-vs:latest
      type: ""

    leaf2:
      kind: sonic-vs
      image: docker-sonic-vs:latest
      type: ""

    # Host containers
    host1:
      kind: linux
      image: ghcr.io/srl-labs/alpine:latest
      exec:
        - sh -c "ip addr add 192.168.1.10/24 dev eth1 || true"
        - sh -c "ip route del default via 172.20.20.1 dev eth0 || true"
        - sh -c "ip route add default via 192.168.1.1 dev eth1 || true"

    host2:
      kind: linux
      image: ghcr.io/srl-labs/alpine:latest
      exec:
        - sh -c "ip addr add 192.168.2.10/24 dev eth1 || true"
        - sh -c "ip route del default via 172.20.20.1 dev eth0 || true"
        - sh -c "ip route add default via 192.168.2.1 dev eth1 || true"

  links:
    # Spine1 to Leaf connections
    - endpoints: ["spine1:eth1", "leaf1:eth1"]
    - endpoints: ["spine1:eth2", "leaf2:eth1"]

    # Spine2 to Leaf connections
    - endpoints: ["spine2:eth1", "leaf1:eth2"]
    - endpoints: ["spine2:eth2", "leaf2:eth2"]

    # Host connections
    - endpoints: ["leaf1:eth3", "host1:eth1"]
    - endpoints: ["leaf2:eth3", "host2:eth1"]